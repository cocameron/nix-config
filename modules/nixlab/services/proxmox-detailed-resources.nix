  {
    type = "custom-api";
    title = "Proxmox-VE Resources";
    cache = "1m";
    url = "http://192.168.1.222:8006/api2/json/cluster/resources";
    allow-insecure = true;
    headers = {
      Accept = "application/json";
      Authorization = {
       _secret = "/run/secrets/proxmox_token";
	};
    };
    options = {
      cpu_graph = true;
      disk_graph = true;
      ram_graph = true;
    };
    template = "<style>\n  .proxmox-container { font-size: 0.9em; }\n  .resource-header, .resource-row { display: flex; border-collapse: collapse; align-items: center; gap: 10px; padding: 4px 0;}\n  .resource-row { text-transform: lowercase;}\n  .resource-header { text-transform: uppercase; font-size: 1em; font-weight: bold; color: var(--color-primary); border-bottom: 1px solid var(--color-primary); margin-bottom: 1px;}\n  .col { min-width: 0; margin-right: 15px; }\n  .col-item { flex: 1.5; color: var(--color-primary);}\n  .col-type { flex: 1; }\n  .col-ram { flex: 2; }\n  .col-cpu { flex: 2; }\n  .col-disk { flex: 2; }\n  .col-status { flex: 0.5; text-align: center; }\n  .server-type { padding: 2px 6px; border-radius: 4px; text-transform: lowercase; }\n  .stat-header { display: flex; justify-content: space-between; align-items: flex-end; font-size: 0.85em;}\n  .stat-percent { font-weight: 500;}\n  .status-indicator { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-left: 4px;}\n  .indicator-positive { background-color: var(--color-positive); }\n  .indicator-negative { background-color: var(--color-negative); }\n</style>\n\n{{ if eq .Response.StatusCode 200 }}\n  <div class=\"proxmox-container\">\n    {{- $filteredResources := .JSON.Array \"data.#(type!=\\\"node\\\" and type!=\\\"sdn\\\")#\" -}}\n    {{- $sortedResources := sortByString \"type\" \"asc\" $filteredResources -}}\n    {{- $bytesInGB := toFloat 1073741824 -}}\n\n    <div class=\"resource-header\">\n      <div class=\"col col-item\">ITEM</div>\n      <div class=\"col col-type\">TYPE</div>\n      {{ if .Options.BoolOr \"ram_graph\" true }}<div class=\"col col-ram\">RAM</div>{{ end }}\n      {{ if .Options.BoolOr \"cpu_graph\" true }}<div class=\"col col-cpu\">CPU</div>{{ end }}\n      {{ if .Options.BoolOr \"disk_graph\" true }}<div class=\"col col-disk\">DISK</div>{{ end }}\n      <div class=\"col col-status\">STATUS</div>\n    </div>\n\n    {{- range $sortedResources -}}\n      {{- $type := .String \"type\" -}}\n        {{ if and (ne $type \"node\") (ne $type \"sdn\") }}\n          <div class=\"resource-row\">\n            \n            <div class=\"col col-item\" title=\"{{ if .Exists \"name\" }}{{ .String \"name\" }}{{ else }}{{ .String \"storage\" }}{{ end }}\">\n              {{ if .Exists \"name\" }}{{ .String \"name\" }}{{ else }}{{ .String \"storage\" }}{{ end }}\n            </div>\n          \n            <div class=\"col col-type\">\n              <span class=\"server-type\">{{ $type }}</span>\n            </div>\n\n            {{ if $.Options.BoolOr \"ram_graph\" true }}\n              <div class=\"col col-ram\">\n                {{- if and (or (eq $type \"qemu\") (eq $type \"lxc\")) (gt (.Float \"maxmem\") 0.0) -}}\n                  <div data-popover-type=\"html\">\n                    <div data-popover-html>Usage: {{ printf \"%.1f\" (div (.Float \"mem\") $bytesInGB) }}GB<br>Total: {{ printf \"%.1f\" (div (.Float \"maxmem\") $bytesInGB) }}GB</div>\n                    <div class=\"stat-header\"><span class=\"stat-percent\">{{ mul (div (.Float \"mem\") (.Float \"maxmem\")) 100 | toInt }}%</span></div>\n                    <div class=\"progress-bar\"><div class=\"progress-value{{ if ge (mul (div (.Float \"mem\") (.Float \"maxmem\")) 100 | toInt) 80 }} progress-value-notice{{ end }}\" style=\"--percent: {{ mul (div (.Float \"mem\") (.Float \"maxmem\")) 100 | toInt }}\"></div></div>\n                  </div>\n                {{- end -}}\n              </div>\n            {{ end }}\n\n            {{ if $.Options.BoolOr \"cpu_graph\" true }}\n              <div class=\"col col-cpu\">\n                {{- if and (or (eq $type \"qemu\") (eq $type \"lxc\")) -}}\n                  {{- $percentCPU := mul (.Float \"cpu\") 100 | toInt -}}\n                  <div data-popover-type=\"html\">\n                    <div data-popover-html>Load: {{ $percentCPU }}%<br>Cores: {{ .Int \"maxcpu\" }}</div>\n                    <div class=\"stat-header\"><span class=\"stat-percent\">{{ $percentCPU }}%</span></div>\n                    <div class=\"progress-bar\"><div class=\"progress-value{{ if ge $percentCPU 80 }} progress-value-notice{{ end }}\" style=\"--percent: {{ $percentCPU }}\"></div></div>\n                  </div>\n                {{- end -}}\n              </div>\n            {{ end }}\n            \n            {{ if $.Options.BoolOr \"disk_graph\" true }}\n              <div class=\"col col-disk\">\n                {{- if and (or (eq $type \"lxc\") (eq $type \"storage\")) (gt (.Float \"maxdisk\") 0.0) -}}\n                  <div data-popover-type=\"html\">\n                    <div data-popover-html>Usage: {{ printf \"%.1f\" (div (.Float \"disk\") $bytesInGB) }}GB<br>Total: {{ printf \"%.1f\" (div (.Float \"maxdisk\") $bytesInGB) }}GB</div>\n                    <div class=\"stat-header\"><span class=\"stat-percent\">{{ mul (div (.Float \"disk\") (.Float \"maxdisk\")) 100 | toInt }}%</span></div>\n                    <div class=\"progress-bar\"><div class=\"progress-value{{ if ge (mul (div (.Float \"disk\") (.Float \"maxdisk\")) 100 | toInt) 80 }} progress-value-notice{{ end }}\" style=\"--percent: {{ mul (div (.Float \"disk\") (.Float \"maxdisk\")) 100 | toInt }}\"></div></div>\n                  </div>\n                {{- end -}}\n              </div>\n            {{ end }}\n\n            <div class=\"col col-status\">\n              {{- $status := .String \"status\" -}}\n              <span class=\"status-indicator {{ if or (eq $status \"running\") (eq $status \"available\") (eq $status \"ok\") (eq $status \"online\")}}indicator-positive{{ else }}indicator-negative{{ end }}\"\n                    data-popover-type=\"text\" data-popover-text=\"{{ $status }}\">\n              </span>\n            </div>\n          </div>\n        {{ end }}\n    {{- end -}}\n  </div>\n{{ else }}\n  <p>Failed: {{ .Response.Status }}</p>\n{{ end }}";
  }
