{
  type = "custom-api";
  title = "qBittorrent";
  cache = "10s";
  options = {
    view = "detailed";
    mode = "default";
  };
  subrequests = {
    transfer = {
      url = "http://127.0.0.1:8200/api/v2/transfer/info";
    };
    seeding = {
      url = "http://127.0.0.1:8200/api/v2/torrents/info";
      parameters = {
        filter = "seeding";
      };
    };
    leeching = {
      url = "http://127.0.0.1:8200/api/v2/torrents/info";
      parameters = {
        filter = "downloading";
      };
    };
  };
  template = "{{ $transfer := .Subrequest \"transfer\" }}\n{{ $seeding := .Subrequest \"seeding\" }}\n{{ $leeching := .Subrequest \"leeching\" }}\n\n{{ if and (eq $transfer.Response.StatusCode 200) (eq $seeding.Response.StatusCode 200) (eq $leeching.Response.StatusCode 200) }}\n\n  {{ $isDetailed := eq (.Options.StringOr \"view\" \"detailed\") \"detailed\" }}\n  {{ $mode := .Options.StringOr \"mode\" \"default\" }}\n\n  {{ if $isDetailed }}\n  <!-- Detailed View -->\n  <div class=\"list\" style=\"--list-gap: 15px;\">\n    <div class=\"flex justify-between text-center\">\n      <div>\n        {{ $dlSpeed := $transfer.JSON.Float \"dl_info_speed\" }}\n        {{ if eq $mode \"upload\" }}\n          <div class=\"color-highlight size-h3\">{{ printf \"%.1f MB/s\" (div $dlSpeed 1000000.0) }}</div>\n        {{ else }}\n          {{ if lt $dlSpeed 1048576.0 }}\n            <div class=\"color-highlight size-h3\">{{ printf \"%.0f KiB/s\" (div $dlSpeed 1024.0) }}</div>\n          {{ else }}\n            <div class=\"color-highlight size-h3\">{{ printf \"%.1f MiB/s\" (div $dlSpeed 1048576.0) }}</div>\n          {{ end }}\n        {{ end }}\n        <div class=\"size-h6\">DOWNLOADING</div>\n      </div>\n\n      {{ if eq $mode \"upload\" }}\n      <div>\n        {{ $ulSpeed := $transfer.JSON.Float \"up_info_speed\" }}\n        <div class=\"color-highlight size-h3\">{{ printf \"%.1f MB/s\" (div $ulSpeed 1000000.0) }}</div>\n        <div class=\"size-h6\">UPLOADING</div>\n      </div>\n      {{ end }}\n\n      <div>\n        <div class=\"color-highlight size-h3\">{{ len ($seeding.JSON.Array \"\") }}</div>\n        <div class=\"size-h6\">SEEDING</div>\n      </div>\n\n      {{ if eq $mode \"default\" }}\n      <div>\n        <div class=\"color-highlight size-h3\">{{ len ($leeching.JSON.Array \"\") }}</div>\n        <div class=\"size-h6\">LEECHING</div>\n      </div>\n      {{ end }}\n    </div>\n\n    <!-- Downloading list -->\n    {{ $downloadingTorrents := $leeching.JSON.Array \"\" }}\n    {{ if gt (len $downloadingTorrents) 0 }}\n      <div style=\"margin-top: 15px;\">\n        <ul class=\"list collapsible-container\" data-collapse-after=\"0\" style=\"--list-gap: 15px;\">\n          {{ range $t := $downloadingTorrents }}\n            {{ $state := $t.String \"state\" }}\n            {{ $icon := \"?\" }}\n            {{ if ge ($t.Int \"completed\") ($t.Int \"size\") }}{{ $icon = \"✔\" }}\n            {{ else if eq $state \"downloading\" \"forcedDL\" }}{{ $icon = \"↓\" }}\n            {{ else if eq $state \"pausedDL\" \"stoppedDL\" \"pausedUP\" \"stalledDL\" \"stalledUP\" \"queuedDL\" \"queuedUP\" }}{{ $icon = \"❚❚\" }}\n            {{ else if eq $state \"error\" \"missingFiles\" }}{{ $icon = \"!\" }}\n            {{ else if eq $state \"checkingDL\" \"checkingUP\" \"allocating\" }}{{ $icon = \"…\" }}\n            {{ else if eq $state \"checkingResumeData\" }}{{ $icon = \"⟳\" }}\n            {{ end }}\n\n            <li class=\"flex items-center\" style=\"gap: 10px;\">\n              <div class=\"size-h4\" style=\"flex-shrink: 0;\">{{ $icon }}</div>\n              <div style=\"flex-grow: 1; min-width: 0;\">\n                <div class=\"text-truncate color-highlight\">{{ $t.String \"name\" }}</div>\n                <div title=\"{{ $t.Float \"progress\" | mul 100 | printf \"%.1f\" }}%\" style=\"background: rgba(128, 128, 128, 0.2); border-radius: 5px; height: 6px; margin-top: 5px; overflow: hidden;\">\n                  <div style=\"width: {{ $t.Float \"progress\" | mul 100 }}%; background-color: var(--color-positive); height: 100%; border-radius: 5px;\"></div>\n                </div>\n              </div>\n              <div style=\"flex-shrink: 0; text-align: right; width: 80px;\">\n                {{ $dlSpeed := $t.Float \"dlspeed\" }}\n                <div class=\"size-sm color-paragraph\">\n                  {{ if eq $mode \"upload\" }}\n                    {{ if lt $dlSpeed 1000.0 }}--{{ else }}{{ printf \"%.1f MB/s\" (div $dlSpeed 1000000.0) }}{{ end }}\n                  {{ else }}\n                    {{ if lt $dlSpeed 1024.0 }}--{{ else if lt $dlSpeed 1048576.0 }}{{ printf \"%.0f KiB/s\" (div $dlSpeed 1024.0) }}{{ else }}{{ printf \"%.1f MiB/s\" (div $dlSpeed 1048576.0) }}{{ end }}\n                  {{ end }}\n                </div>\n                {{ $eta := $t.Int \"eta\" }}\n                <div class=\"size-sm color-paragraph\">\n                  {{ if eq $eta 8640000 }}∞\n                  {{ else if gt $eta 3600 }}{{ printf \"%dh %dm\" (div $eta 3600) (mod (div $eta 60) 60) }}\n                  {{ else if gt $eta 0 }}{{ printf \"%dm\" (div $eta 60) }}\n                  {{ else }}--{{ end }}\n                </div>\n              </div>\n            </li>\n          {{ end }}\n        </ul>\n      </div>\n    {{ end }}\n\n    <!-- Seeding list -->\n    {{ if eq $mode \"upload\" }}\n      {{ $seedingTorrents := $seeding.JSON.Array \"\" }}\n      {{ if gt (len $seedingTorrents) 0 }}\n        <div style=\"margin-top: 20px;\">\n          <ul class=\"list collapsible-container\" data-collapse-after=\"0\" style=\"--list-gap: 15px;\">\n            {{ range $t := $seedingTorrents }}\n              {{ $state := $t.String \"state\" }}\n              {{ $icon := \"↑\" }}\n              {{ if eq $state \"pausedUP\" \"stoppedUP\" \"stalledUP\" \"queuedUP\" }}{{ $icon = \"❚❚\" }}\n              {{ else if eq $state \"error\" \"missingFiles\" }}{{ $icon = \"!\" }}\n              {{ else if eq $state \"checkingUP\" }}{{ $icon = \"…\" }}\n              {{ else if eq $state \"checkingResumeData\" }}{{ $icon = \"⟳\" }}\n              {{ end }}\n\n              <li class=\"flex items-center\" style=\"gap: 10px;\">\n                <div class=\"size-h4\" style=\"flex-shrink: 0;\">{{ $icon }}</div>\n                <div style=\"flex-grow: 1; min-width: 0;\">\n                  <div class=\"text-truncate color-highlight\">{{ $t.String \"name\" }}</div>\n                  <div class=\"size-sm color-paragraph\">\n                    Ratio: {{ printf \"%.2f\" ($t.Float \"ratio\") }} |\n                    Size: {{ printf \"%.1f GB\" (div ($t.Float \"size\") 1073741824.0) }}\n                  </div>\n                </div>\n                <div style=\"flex-shrink: 0; text-align: right; width: 80px;\">\n                  {{ $ulSpeed := $t.Float \"upspeed\" }}\n                  <div class=\"size-sm color-paragraph\">\n                    {{ if lt $ulSpeed 1000.0 }}--{{ else }}{{ printf \"%.1f MB/s\" (div $ulSpeed 1000000.0) }}{{ end }}\n                  </div>\n                  <div class=\"size-sm color-paragraph\">Upload</div>\n                </div>\n              </li>\n            {{ end }}\n          </ul>\n        </div>\n      {{ end }}\n    {{ end }}\n\n  </div>\n\n  {{ else }}\n  <!-- Basic View -->\n  <div class=\"flex justify-between text-center\">\n    <div>\n      {{ $dlSpeed := $transfer.JSON.Float \"dl_info_speed\" }}\n      <div class=\"color-highlight size-h3\">{{ printf \"%.1f MB/s\" (div $dlSpeed 1000000.0) }}</div>\n      <div class=\"size-h6\">DOWNLOADING</div>\n    </div>\n    {{ if eq $mode \"upload\" }}\n    <div>\n      {{ $ulSpeed := $transfer.JSON.Float \"up_info_speed\" }}\n      <div class=\"color-highlight size-h3\">{{ printf \"%.1f MB/s\" (div $ulSpeed 1000000.0) }}</div>\n      <div class=\"size-h6\">UPLOADING</div>\n    </div>\n    {{ end }}\n    <div>\n      <div class=\"color-highlight size-h3\">{{ len ($seeding.JSON.Array \"\") }}</div>\n      <div class=\"size-h6\">SEEDING</div>\n    </div>\n    {{ if eq $mode \"default\" }}\n    <div>\n      <div class=\"color-highlight size-h3\">{{ len ($leeching.JSON.Array \"\") }}</div>\n      <div class=\"size-h6\">LEECHING</div>\n    </div>\n    {{ end }}\n  </div>\n  {{ end }}\n\n{{ else }}\n  <div class=\"color-negative text-center\">\n    <p>Error fetching qBittorrent data.</p>\n    <p class=\"size-sm\">Check URL and authentication bypass settings.</p>\n  </div>\n{{ end }}";
}
